<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Autosuggest</title>
    <link rel="stylesheet" href="<%= htmlWebpackPlugin.options.css %>">
  </head>

  <body>
    <!-- search container -->
    <div class="container">
      <h1>search on wikipedia</h1>
      <div class="search loupe">
        <input type="text" id="search" class="full-width" autocomplete="off" placeholder="search for some text">
      </div>
    </div>

    <script type="text/javascript">
      if (!('Promise' in window)) {
        const script = document.createElement('script');
        script.src = 'https://polyfill.io/v3/polyfill.min.js?features=Promise';
        document.getElementsByTagName('head')[0].appendChild(script);
      }
    </script>
    <script type="text/javascript">
      window.addEventListener('DOMContentLoaded', () => {
        // eslint-disable-next-line no-new
        new Autosuggest('search', {
          howManyCharacters: 2,
          delay: 500,
          placeholderError: 'something went wrong...',
          clearButton: true,
          noResult: 'No result',
          dataAPI: {
            // dynamically adding search text to the url, optional
            searchLike: true,
            // wikipedia API
            path:
              'https://en.wikipedia.org/w/api.php?action=query&list=search&format=json&origin=*&srsearch=',
            // path: 'https://cdn.jsdelivr.net/gh/tomik23/autosuggest@master/docs/users.json',
            // static files
            // path: '../static/users.json'
          },
          htmlTemplate: (matches) => {
            // const regex = new RegExp(`^${matches.searchText}`, 'gi'); // start with
            const regex = new RegExp(`${matches.searchText}`, 'gi');
            const html = matches.query.search
              .sort((a, b) => a.title.localeCompare(b.title))
              .filter((element) => {
                return element.title.match(regex);
              })
              .map((el) => {
                return `
                  <li class="autocomplete-item loupe" role="option" aria-selected="false" tabindex="-1">
                    <p>${el.title.replace(regex, (str) => `${str}`)}</p>
                    <!-- <small>${el.snippet}</small> -->
                  </li>`;
              });
            return html.join('');
          },
          // enabling the onsubmit event
          onSubmit: (matches) => {
            // eslint-disable-next-line no-console
            // console.log(matches);
            window.open(`https://en.wikipedia.org/wiki/${encodeURI(matches)}`);
          },
        });
      });
    </script>
  </body>

</html>