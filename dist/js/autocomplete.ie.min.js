var Autocomplete=function(){"use strict";var e=function(e,t){for(var s in t)"addClass"===s?e.classList.add(t[s]):"removeClass"===s?e.classList.remove(t[s]):e.setAttribute(s,t[s])},t=function(e,t){return t.value=function(e){return e.firstElementChild||e}(e).textContent.trim()},s=function(e,t){e.scrollTop=e.offsetTop-t.offsetHeight},i=function(e,t){e.setAttribute("aria-activedescendant",t||"")},n=function(e,t,s,i){var n=i.previousSibling,r=n?n.offsetHeight:0;if("0"==e.getAttribute("aria-posinset")&&(i.scrollTop=e.offsetTop-function(e,t){var s=document.querySelectorAll("#"+e+" > li:not(."+t+")"),i=0;return[].slice.call(s).map((function(e){return i+=e.offsetHeight})),i}(t,s)),e.offsetTop-r<i.scrollTop)i.scrollTop=e.offsetTop-r;else{var o=e.offsetTop+e.offsetHeight-r;o>i.scrollTop+i.offsetHeight&&(i.scrollTop=o-i.offsetHeight)}},r=27,o=13,a=38,l=40,c=9;return function(d,u){var h,v=this,f=u.delay,m=void 0===f?500:f,p=u.clearButton,L=void 0===p||p,x=u.howManyCharacters,g=void 0===x?1:x,A=u.selectFirst,b=void 0!==A&&A,y=u.insertToInput,C=void 0!==y&&y,S=u.showAllValues,E=void 0!==S&&S,T=u.cache,B=void 0!==T&&T,k=u.disableCloseOnSelect,w=void 0!==k&&k,I=u.classGroup,R=u.classPreventClosing,F=u.classPrefix,O=u.ariaLabelClear,D=u.onSearch,j=u.onResults,G=void 0===j?function(){}:j,H=u.onSubmit,V=void 0===H?function(){}:H,W=u.onOpened,q=void 0===W?function(){}:W,M=u.onReset,N=void 0===M?function(){}:M,P=u.onRender,U=void 0===P?function(){}:P,K=u.onClose,J=void 0===K?function(){}:K,$=u.noResults,z=void 0===$?function(){}:$,Q=u.onSelectedItem,X=void 0===Q?function(){}:Q;this.init=function(){var t=v.resultList,s=v.root;v.clearbutton(),function(t,s,i,n,r){e(s,{id:i,tabIndex:"0",role:"listbox"}),e(n,{addClass:r+"-results-wrapper"}),n.insertAdjacentElement("beforeend",s),t.parentNode.insertBefore(n,t.nextSibling)}(s,t,v.outputUl,v.resultWrap,v.prefix),s.addEventListener("input",v.handleInput),v.showAll&&s.addEventListener("click",v.handleInput),v.onRender({element:s,results:t})},this.cacheAct=function(e,t){var s=v.root;v.cache&&("update"===e?s.setAttribute(v.cacheData,t.value):"remove"===e?s.removeAttribute(v.cacheData):s.value=s.getAttribute(v.cacheData))},this.handleInput=function(e){var t=e.target,s=e.type;if("true"!==v.root.getAttribute("aria-expanded")||"click"!==s){var i=t.value.replace(v.regex,"\\$&");v.cacheAct("update",t);var n=v.showAll?0:v.delay;clearTimeout(v.timeout),v.timeout=setTimeout((function(){v.searchItem(i.trim())}),n)}},this.reset=function(){var t;e(v.root,{"aria-owns":v.id+"-list","aria-expanded":"false","aria-autocomplete":"list","aria-activedescendant":"",role:"combobox",removeClass:"auto-expanded"}),v.resultWrap.classList.remove(v.isActive),(0==(null==(t=v.matches)?void 0:t.length)&&!v.toInput||v.showAll)&&(v.resultList.innerHTML=""),v.index=v.selectFirst?0:-1,v.onClose()},this.searchItem=function(e){v.value=e,v.onLoading(!0),function(e,t){void 0===e&&(e=!1),e&&(e.classList.remove("hidden"),e.addEventListener("click",t))}(v.cBtn,v.destroy),0==e.length&&v.clearButton&&v.cBtn.classList.add("hidden"),v.characters>e.length&&!v.showAll?v.onLoading():v.onSearch({currentValue:e,element:v.root}).then((function(t){var s=v.root.value.length,i=t.length;v.matches=Array.isArray(t)?[].concat(t):JSON.parse(JSON.stringify(t)),v.onLoading(),v.error(),0==i&&0==s&&v.cBtn.classList.add("hidden"),0==i&&s?(v.root.classList.remove("auto-expanded"),v.reset(),v.noResults({element:v.root,currentValue:e,template:v.results}),v.events()):(i>0||function(e){return e&&"object"==typeof e&&e.constructor===Object}(t))&&(v.index=v.selectFirst?0:-1,v.results(),v.events())})).catch((function(){v.onLoading(),v.reset()}))},this.onLoading=function(e){return v.root.parentNode.classList[e?"add":"remove"](v.isLoading)},this.error=function(){return v.root.classList.remove(v.err)},this.events=function(){var e=v.root,t=v.resultList;e.addEventListener("keydown",v.handleKeys),e.addEventListener("click",v.handleShowItems),["mousemove","click"].map((function(e){t.addEventListener(e,v.handleMouse)})),document.addEventListener("click",v.handleDocClick)},this.results=function(t){e(v.root,{"aria-expanded":"true",addClass:v.prefix+"-expanded"}),v.resultList.innerHTML=0===v.matches.length?v.onResults({currentValue:v.value,matches:0,template:t}):v.onResults({currentValue:v.value,matches:v.matches,classGroup:v.classGroup}),v.resultWrap.classList.add(v.isActive);var i=v.classGroup?":not(."+v.classGroup+")":"";v.itemsLi=document.querySelectorAll("#"+v.outputUl+" > li"+i),v.selectFirstEl(),v.onOpened({type:"results",element:v.root,results:v.resultList}),function(t){for(var s=0;s<t.length;s++)e(t[s],{role:"option",tabindex:"-1","aria-selected":"false","aria-setsize":t.length,"aria-posinset":s})}(v.itemsLi),s(v.resultList,v.resultWrap)},this.handleDocClick=function(e){var t=e.target,s=null;(t.closest("ul")&&v.disable||t.closest("."+v.prevClosing))&&(s=!0),t.id===v.id||s||v.reset()},this.selectFirstEl=function(){var t=v.index,s=v.activeList,n=v.selectedOption,r=v.selectFirst,o=v.root;if(v.remAria(document.querySelector("."+s)),r){var a=v.resultList.firstElementChild,l=v.classGroup&&v.matches.length>0&&r?a.nextElementSibling:a;e(l,{id:n+"-0",addClass:s,"aria-selected":"true"}),v.onSelected({index:t,element:o,object:v.matches[t]}),i(o,n+"-0")}},this.setAttr=function(e,t){for(var s in t)"addClass"===s?e.classList.add(t[s]):"removeClass"===s?e.classList.remove(t[s]):e.setAttribute(s,t[s])},this.handleShowItems=function(){var t=v.root,i=v.resultWrap,n=v.resultList,r=v.isActive;n.textContent.length>0&&!i.classList.contains(r)&&(e(t,{"aria-expanded":"true",addClass:v.prefix+"-expanded"}),i.classList.add(r),s(n,i),v.selectFirstEl(),v.onOpened({type:"showItems",element:t,results:n}))},this.handleMouse=function(e){e.preventDefault();var t=e.target,s=e.type,i=t.closest("li"),n=null==i?void 0:i.hasAttribute("role"),r=v.activeList,o=document.querySelector("."+r);i&&n&&("click"===s&&v.getTextFromLi(i),"mousemove"!==s||i.classList.contains(r)||(v.remAria(o),v.setAria(i),v.index=v.indexLiSelected(i),v.onSelected({index:v.index,element:v.root,object:v.matches[v.index]})))},this.getTextFromLi=function(e){var s=v.root,i=v.index,n=v.disable;e&&0!==v.matches.length?(t(e,s),v.onSubmit({index:i,element:s,object:v.matches[i],results:v.resultList}),n||(v.remAria(e),v.reset()),v.clearButton&&v.cBtn.classList.remove("hidden"),v.cacheAct("remove")):!n&&v.reset()},this.indexLiSelected=function(e){return Array.prototype.indexOf.call(v.itemsLi,e)},this.handleKeys=function(e){var s=v.root,n=e.keyCode,d=v.resultWrap.classList.contains(v.isActive),u=v.matches.length+1;switch(v.selectedLi=document.querySelector("."+v.activeList),n){case a:case l:if(e.preventDefault(),u<=1&&v.selectFirst||!d)return;n===a?(v.index<0&&(v.index=u-1),v.index-=1):(v.index+=1,v.index>=u&&(v.index=0)),v.remAria(v.selectedLi),u>0&&v.index>=0&&v.index<u-1?(v.onSelected({index:v.index,element:s,object:v.matches[v.index]}),v.setAria(v.itemsLi[v.index]),v.toInput&&d&&t(v.itemsLi[v.index],s)):(v.cacheAct(),i(s));break;case o:v.getTextFromLi(v.selectedLi);break;case c:case r:e.stopPropagation(),v.reset()}},this.setAria=function(t){var s=v.selectedOption+"-"+v.indexLiSelected(t);e(t,{id:s,"aria-selected":"true",addClass:v.activeList}),i(v.root,s),n(t,v.outputUl,v.classGroup,v.resultList)},this.remAria=function(t){t&&e(t,{id:"",removeClass:v.activeList,"aria-selected":"false"})},this.clearbutton=function(){if(v.clearButton){var t=v.cBtn,s=v.clearBtnAriLabel;e(t,{class:v.prefix+"-clear hidden",type:"button",title:s,"aria-label":s}),v.root.insertAdjacentElement("afterend",t)}},this.destroy=function(){var e=v.root;v.clearButton&&v.cBtn.classList.add("hidden"),e.value="",e.focus(),v.resultList.textContent="",v.reset(),v.error(),v.onReset(e),e.removeEventListener("keydown",v.handleKeys),e.removeEventListener("click",v.handleShowItems),document.removeEventListener("click",v.handleDocClick)},this.id=d,this.root=document.getElementById(d),this.onSearch=(h=D,Boolean(h&&"function"==typeof h.then)?D:function(e){var t=e.currentValue,s=e.element;return Promise.resolve(D({currentValue:t,element:s}))}),this.onResults=G,this.onRender=U,this.onSubmit=V,this.onSelected=X,this.onOpened=q,this.onReset=N,this.noResults=z,this.onClose=J,this.delay=m,this.characters=g,this.clearButton=L,this.selectFirst=b,this.toInput=C,this.showAll=E,this.classGroup=I,this.prevClosing=R,this.clearBtnAriLabel=O||"clear the search query",this.prefix=F?F+"-auto":"auto",this.disable=w,this.cache=B,this.outputUl=this.prefix+"-"+this.id+"-results",this.cacheData="data-cache-auto-"+this.id,this.isLoading=this.prefix+"-is-loading",this.isActive=this.prefix+"-is-active",this.activeList=this.prefix+"-selected",this.selectedOption=this.prefix+"-selected-option",this.err=this.prefix+"-error",this.regex=/[|\\{}()[\]^$+*?.]/g,this.timeout=null,this.resultWrap=document.createElement("div"),this.resultList=document.createElement("ul"),this.cBtn=document.createElement("button"),this.init()}}();
