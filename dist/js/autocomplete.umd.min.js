!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):(t="undefined"!=typeof globalThis?globalThis:t||self).Autocomplete=s()}(this,(function(){"use strict";const t=(t,s)=>{for(let i in s)"addClass"===i?t.classList.add(s[i]):"removeClass"===i?t.classList.remove(s[i]):t.setAttribute(i,s[i])},s=(t,s)=>s.value=(t=>t.firstElementChild||t)(t).textContent.trim(),i=(t,s)=>{t.scrollTop=t.offsetTop-s.offsetHeight},h=(t,s)=>{t.setAttribute("aria-activedescendant",s||"")},e=(t,s,i,h)=>{const e=h.previousSibling,a=e?e.offsetHeight:0;if("0"==t.getAttribute("aria-posinset")&&(h.scrollTop=t.offsetTop-((t,s)=>{const i=document.querySelectorAll("#"+t+" > li:not(."+s+")");let h=0;return[].slice.call(i).map(t=>h+=t.offsetHeight),h})(s,i)),t.offsetTop-a<h.scrollTop)h.scrollTop=t.offsetTop-a;else{const s=t.offsetTop+t.offsetHeight-a;s>h.scrollTop+h.offsetHeight&&(h.scrollTop=s-h.offsetHeight)}},a=t=>document.createElement(t),n=27,l=13,o=38,r=40,c=9;return class{constructor(d,u){let{delay:m=500,clearButton:p=!0,howManyCharacters:f=1,selectFirst:b=!1,insertToInput:y=!1,showAllValues:v=!1,cache:x=!1,disableCloseOnSelect:C=!1,classGroup:k,classPreventClosing:g,classPrefix:w,ariaLabelClear:j,onSearch:V,onResults:S=(()=>{}),onSubmit:O=(()=>{}),onOpened:T=(()=>{}),onReset:I=(()=>{}),onRender:R=(()=>{}),onClose:A=(()=>{}),noResults:P=(()=>{}),onSelectedItem:B=(()=>{})}=u;var G;this.t=()=>{var s,i,h,e,a;this.s(),s=this.i,i=this.h,h=this.l,e=this.o,a=this.u,t(i,{id:h,tabIndex:"0",role:"listbox"}),t(e,{addClass:a+"-results-wrapper"}),e.insertAdjacentElement("beforeend",i),s.parentNode.insertBefore(e,s.nextSibling),this.i.addEventListener("input",this.m),this.p&&this.i.addEventListener("click",this.m),this.v({element:this.i,results:this.h})},this.C=(t,s)=>{this.k&&("update"===t?this.i.setAttribute(this.g,s.value):"remove"===t?this.i.removeAttribute(this.g):this.i.value=this.i.getAttribute(this.g))},this.m=t=>{let{target:s,type:i}=t;if("true"===this.i.getAttribute("aria-expanded")&&"click"===i)return;const h=s.value.replace(this.j,"\\$&");this.C("update",s);const e=this.p?0:this.V;clearTimeout(this.S),this.S=setTimeout(()=>{this.O(h.trim())},e)},this.T=()=>{var s;t(this.i,{"aria-owns":this.I+"-list","aria-expanded":"false","aria-autocomplete":"list","aria-activedescendant":"",role:"combobox",removeClass:"auto-expanded"}),this.o.classList.remove(this.R),(0==(null==(s=this.A)?void 0:s.length)&&!this.P||this.p)&&(this.h.innerHTML=""),this.B=this.G?0:-1,this.J()},this.O=t=>{this.N=t,this.$(!0),function(t,s){void 0===t&&(t=!1),t&&(t.classList.remove("hidden"),t.addEventListener("click",s))}(this.q,this.destroy),0==t.length&&this.F&&this.q.classList.add("hidden"),this.L>t.length&&!this.p?this.$():this.M({currentValue:t,element:this.i}).then(s=>{const i=this.i.value.length,h=s.length;this.A=Array.isArray(s)?[...s]:JSON.parse(JSON.stringify(s)),this.$(),this.D(),0==h&&0==i&&this.q.classList.add("hidden"),0==h&&i?(this.i.classList.remove("auto-expanded"),this.T(),this.H({element:this.i,currentValue:t,template:this.K}),this.U()):(h>0||(t=>t&&"object"==typeof t&&t.constructor===Object)(s))&&(this.B=this.G?0:-1,this.K(),this.U())}).catch(()=>{this.$(),this.T()})},this.$=t=>this.i.parentNode.classList[t?"add":"remove"](this.W),this.D=()=>this.i.classList.remove(this.X),this.U=()=>{this.i.addEventListener("keydown",this.Y),this.i.addEventListener("click",this.Z),["mousemove","click"].map(t=>{this.h.addEventListener(t,this._)}),document.addEventListener("click",this.tt)},this.K=s=>{t(this.i,{"aria-expanded":"true",addClass:this.u+"-expanded"}),this.h.innerHTML=0===this.A.length?this.st({currentValue:this.N,matches:0,template:s}):this.st({currentValue:this.N,matches:this.A,classGroup:this.it}),this.o.classList.add(this.R);const h=this.it?":not(."+this.it+")":"";this.ht=document.querySelectorAll("#"+this.l+" > li"+h),(s=>{for(let i=0;i<s.length;i++)t(s[i],{role:"option",tabindex:"-1","aria-selected":"false","aria-setsize":s.length,"aria-posinset":i})})(this.ht),this.et({type:"results",element:this.i,results:this.h}),this.at(),i(this.h,this.o)},this.tt=t=>{let{target:s}=t,i=null;(s.closest("ul")&&this.nt||s.closest("."+this.lt))&&(i=!0),s.id===this.I||i||this.T()},this.at=()=>{if(this.ot(document.querySelector("."+this.rt)),!this.G)return;const{firstElementChild:s}=this.h,i=this.it&&this.A.length>0&&this.G?s.nextElementSibling:s;this.ct({index:this.B,element:this.i,object:this.A[this.B]}),t(i,{id:this.dt+"-0",addClass:this.rt,"aria-selected":"true"}),h(this.i,this.dt+"-0")},this.Z=()=>{this.h.textContent.length>0&&!this.o.classList.contains(this.R)&&(t(this.i,{"aria-expanded":"true",addClass:this.u+"-expanded"}),this.o.classList.add(this.R),i(this.h,this.o),this.at(),this.et({type:"showItems",element:this.i,results:this.h}))},this._=t=>{t.preventDefault();const{target:s,type:i}=t,h=s.closest("li"),e=null==h?void 0:h.hasAttribute("role"),a=this.rt,n=document.querySelector("."+a);h&&e&&("click"===i&&this.ut(h),"mousemove"!==i||h.classList.contains(a)||(this.ot(n),this.pt(h),this.B=this.ft(h),this.ct({index:this.B,element:this.i,object:this.A[this.B]})))},this.ut=t=>{t&&0!==this.A.length?(s(t,this.i),this.bt({index:this.B,element:this.i,object:this.A[this.B],results:this.h}),this.nt||(this.ot(t),this.T()),this.F&&this.q.classList.remove("hidden"),this.C("remove")):!this.nt&&this.T()},this.ft=t=>Array.prototype.indexOf.call(this.ht,t),this.Y=t=>{const{keyCode:i}=t,e=this.o.classList.contains(this.R),a=this.A.length+1;switch(this.yt=document.querySelector("."+this.rt),i){case o:case r:if(t.preventDefault(),a<=1&&this.G||!e)return;i===o?(this.B<0&&(this.B=a-1),this.B-=1):(this.B+=1,this.B>=a&&(this.B=0)),this.ot(this.yt),a>0&&this.B>=0&&this.B<a-1?(this.ct({index:this.B,element:this.i,object:this.A[this.B]}),this.pt(this.ht[this.B]),this.P&&e&&s(this.ht[this.B],this.i)):(this.C(),h(this.i));break;case l:this.ut(this.yt);break;case c:case n:t.stopPropagation(),this.T()}},this.pt=s=>{const i=this.dt+"-"+this.ft(s);t(s,{id:i,"aria-selected":"true",addClass:this.rt}),h(this.i,i),e(s,this.l,this.it,this.h)},this.ot=s=>{s&&t(s,{id:"",removeClass:this.rt,"aria-selected":"false"})},this.s=()=>{this.F&&(t(this.q,{class:this.u+"-clear hidden",type:"button",title:this.vt,"aria-label":this.vt}),this.i.insertAdjacentElement("afterend",this.q))},this.destroy=()=>{this.F&&this.q.classList.add("hidden"),this.i.value="",this.i.focus(),this.h.textContent="",this.T(),this.D(),this.xt(this.i),this.i.removeEventListener("keydown",this.Y),this.i.removeEventListener("click",this.Z),document.removeEventListener("click",this.tt)},this.I=d,this.i=document.getElementById(d),this.M=(G=V,Boolean(G&&"function"==typeof G.then)?V:t=>{let{currentValue:s,element:i}=t;return Promise.resolve(V({currentValue:s,element:i}))}),this.st=S,this.v=R,this.bt=O,this.ct=B,this.et=T,this.xt=I,this.H=P,this.J=A,this.V=m,this.L=f,this.F=p,this.G=b,this.P=y,this.p=v,this.it=k,this.lt=g,this.vt=j||"clear the search query",this.u=w?w+"-auto":"auto",this.nt=C,this.k=x,this.l=this.u+"-"+this.I+"-results",this.g="data-cache-auto-"+this.I,this.W=this.u+"-is-loading",this.R=this.u+"-is-active",this.rt=this.u+"-selected",this.dt=this.u+"-selected-option",this.X=this.u+"-error",this.j=/[|\\{}()[\]^$+*?.]/g,this.S=null,this.o=a("div"),this.h=a("ul"),this.q=a("button"),this.t()}}}));
