!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):(t="undefined"!=typeof globalThis?globalThis:t||self).Autocomplete=s()}(this,(function(){"use strict";const t=(t,s)=>{for(let i in s)"addClass"===i?h(t,"add",s[i]):"removeClass"===i?h(t,"remove",s[i]):t.setAttribute(i,s[i])},s=t=>(t.firstElementChild||t).textContent.trim(),i=(t,s)=>{t.scrollTop=t.offsetTop-s.offsetHeight},h=(t,s,i)=>t.classList[s](i),e=(s,i)=>{t(s,{"aria-activedescendant":i||""})},a=(t,s,i,h)=>{const e=h.previousSibling,a=e?e.offsetHeight:0;if("0"==t.getAttribute("aria-posinset")&&(h.scrollTop=t.offsetTop-((t,s)=>{const i=document.querySelectorAll("#"+t+" > li:not(."+s+")");let h=0;return[].slice.call(i).map(t=>h+=t.offsetHeight),h})(s,i)),t.offsetTop-a<h.scrollTop)h.scrollTop=t.offsetTop-a;else{const s=t.offsetTop+t.offsetHeight-a;s>h.scrollTop+h.offsetHeight&&(h.scrollTop=s-h.offsetHeight)}},n=t=>document.createElement(t),l=t=>document.querySelector(t),o=(t,s,i)=>{t.addEventListener(s,i)},r=(t,s,i)=>{t.removeEventListener(s,i)},d=27,c=13,u=38,m=40,p=9;return class{constructor(f,b){let{delay:v=500,clearButton:x=!0,howManyCharacters:y=1,selectFirst:C=!1,insertToInput:k=!1,showAllValues:g=!1,cache:j=!1,disableCloseOnSelect:w=!1,classGroup:V,classPreventClosing:S,classPrefix:O,ariaLabelClear:T,onSearch:I,onResults:R=(()=>{}),onSubmit:A=(()=>{}),onOpened:P=(()=>{}),onReset:B=(()=>{}),onRender:G=(()=>{}),onClose:J=(()=>{}),noResults:N=(()=>{}),onSelectedItem:$=(()=>{})}=b;var q;this.t=()=>{var s,i,h,e,a;this.s(),s=this.i,i=this.h,h=this.l,e=this.o,a=this.u,t(i,{id:h,tabIndex:"0",role:"listbox"}),t(e,{addClass:a+"-results-wrapper"}),e.insertAdjacentElement("beforeend",i),s.parentNode.insertBefore(e,s.nextSibling),o(this.i,"input",this.m),this.p&&o(this.i,"click",this.m),this.v({element:this.i,results:this.h})},this.C=(t,s)=>{this.k&&("update"===t?this.i.setAttribute(this.g,s.value):"remove"===t?this.i.removeAttribute(this.g):this.i.value=this.i.getAttribute(this.g))},this.m=t=>{let{target:s,type:i}=t;if("true"===this.i.getAttribute("aria-expanded")&&"click"===i)return;const h=s.value.replace(this.j,"\\$&");this.C("update",s);const e=this.p?0:this.V;clearTimeout(this.S),this.S=setTimeout(()=>{this.O(h.trim())},e)},this.T=()=>{t(this.i,{"aria-owns":this.I+"-list","aria-expanded":"false","aria-autocomplete":"list","aria-activedescendant":"",role:"combobox",removeClass:"auto-expanded"}),h(this.o,"remove",this.R),this.A=this.P?0:-1,this.B()},this.O=t=>{this.G=t,this.J(!0),function(t,s){void 0===t&&(t=!1),t&&(h(t,"remove","hidden"),o(t,"click",s))}(this.N,this.destroy),0==t.length&&this.$&&h(this.N,"add","hidden"),this.q>t.length&&!this.p?this.J():this.F({currentValue:t,element:this.i}).then(s=>{const i=this.i.value.length,e=s.length;this.L=Array.isArray(s)?s:JSON.parse(JSON.stringify(s)),this.J(),this.M(),0==e&&0==i&&h(this.N,"add","hidden"),0==e&&i?(h(this.i,"remove","auto-expanded"),this.T(),this.D({element:this.i,currentValue:t,template:this.H}),this.K()):(e>0||(t=>t&&"object"==typeof t&&t.constructor===Object)(s))&&(this.A=this.P?0:-1,this.H(),this.K())}).catch(()=>{this.J(),this.T()})},this.J=t=>this.i.parentNode.classList[t?"add":"remove"](this.U),this.M=()=>h(this.i,"remove",this.W),this.K=()=>{o(this.i,"keydown",this.X),o(this.i,"click",this.Y),["mousemove","click"].map(t=>{o(this.h,t,this.Z)}),o(document,"click",this._)},this.H=s=>{t(this.i,{"aria-expanded":"true",addClass:this.u+"-expanded"}),this.h.textContent="";const e=0===this.L.length?this.tt({currentValue:this.G,matches:0,template:s}):this.tt({currentValue:this.G,matches:this.L,classGroup:this.st});this.h.insertAdjacentHTML("afterbegin",e),h(this.o,"add",this.R);const a=this.st?":not(."+this.st+")":"";this.it=document.querySelectorAll("#"+this.l+" > li"+a),(s=>{for(let i=0;i<s.length;i++)t(s[i],{role:"option",tabindex:"-1","aria-selected":"false","aria-setsize":s.length,"aria-posinset":i})})(this.it),this.ht({type:"results",element:this.i,results:this.h}),this.et(),i(this.h,this.o)},this._=t=>{let{target:s}=t,i=null;(s.closest("ul")&&this.at||s.closest("."+this.nt))&&(i=!0),s.id===this.I||i||this.T()},this.et=()=>{if(this.lt(l("."+this.ot)),!this.P)return;const{firstElementChild:s}=this.h,i=this.st&&this.L.length>0&&this.P?s.nextElementSibling:s;this.rt({index:this.A,element:this.i,object:this.L[this.A]}),t(i,{id:this.dt+"-0",addClass:this.ot,"aria-selected":"true"}),e(this.i,this.dt+"-0")},this.Y=()=>{this.h.textContent.length>0&&!h(this.o,"contains",this.R)&&(t(this.i,{"aria-expanded":"true",addClass:this.u+"-expanded"}),h(this.o,"add",this.R),i(this.h,this.o),this.et(),this.ht({type:"showItems",element:this.i,results:this.h}))},this.Z=t=>{t.preventDefault();const{target:s,type:i}=t,e=s.closest("li"),a=null==e?void 0:e.hasAttribute("role"),n=this.ot,o=l("."+n);e&&a&&("click"===i&&this.ct(e),"mousemove"!==i||h(e,"contains",n)||(this.lt(o),this.ut(e),this.A=this.pt(e),this.rt({index:this.A,element:this.i,object:this.L[this.A]})))},this.ct=t=>{t&&0!==this.L.length?(this.i.value=s(t),this.ft({index:this.A,element:this.i,object:this.L[this.A],results:this.h}),this.at||(this.lt(t),this.T()),this.$&&h(this.N,"remove","hidden"),this.C("remove")):!this.at&&this.T()},this.pt=t=>Array.prototype.indexOf.call(this.it,t),this.X=t=>{const{keyCode:i}=t,a=h(this.o,"contains",this.R),n=this.L.length+1;switch(this.bt=l("."+this.ot),i){case u:case m:if(t.preventDefault(),n<=1&&this.P||!a)return;i===u?(this.A<0&&(this.A=n-1),this.A-=1):(this.A+=1,this.A>=n&&(this.A=0)),this.lt(this.bt),this.A>=0&&this.A<n-1?(this.vt&&a&&(this.i.value=s(this.it[this.A])),this.rt({index:this.A,element:this.i,object:this.L[this.A]}),this.ut(this.it[this.A])):(this.C(),e(this.i),this.rt({index:null,element:this.i,object:null}));break;case c:this.ct(this.bt);break;case p:case d:t.stopPropagation(),this.T()}},this.ut=s=>{const i=this.dt+"-"+this.pt(s);t(s,{id:i,"aria-selected":"true",addClass:this.ot}),e(this.i,i),a(s,this.l,this.st,this.h)},this.lt=s=>{s&&t(s,{id:"",removeClass:this.ot,"aria-selected":"false"})},this.s=()=>{this.$&&(t(this.N,{class:this.u+"-clear hidden",type:"button",title:this.xt,"aria-label":this.xt}),this.i.insertAdjacentElement("afterend",this.N))},this.destroy=()=>{this.$&&h(this.N,"add","hidden"),this.i.value="",this.i.focus(),this.h.textContent="",this.T(),this.M(),this.yt(this.i),r(this.i,"keydown",this.X),r(this.i,"click",this.Y),r(document,"click",this._)},this.I=f,this.i=document.getElementById(f),this.F=(q=I,Boolean(q&&"function"==typeof q.then)?I:t=>{let{currentValue:s,element:i}=t;return Promise.resolve(I({currentValue:s,element:i}))}),this.tt=R,this.v=G,this.ft=A,this.rt=$,this.ht=P,this.yt=B,this.D=N,this.B=J,this.V=v,this.q=y,this.$=x,this.P=C,this.vt=k,this.p=g,this.st=V,this.nt=S,this.xt=T||"clear the search query",this.u=O?O+"-auto":"auto",this.at=w,this.k=j,this.l=this.u+"-"+this.I+"-results",this.g="data-cache-auto-"+this.I,this.U=this.u+"-is-loading",this.R=this.u+"-is-active",this.ot=this.u+"-selected",this.dt=this.u+"-selected-option",this.W=this.u+"-error",this.j=/[|\\{}()[\]^$+*?.]/g,this.S=null,this.o=n("div"),this.h=n("ul"),this.N=n("button"),this.t()}}}));
