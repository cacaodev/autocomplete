var Autocomplete=function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}return function s(o,r){var i,a=this,c=r.delay,l=void 0===c?500:c,u=r.clearButton,d=void 0===u||u,h=r.howManyCharacters,m=void 0===h?1:h,f=r.selectFirst,p=void 0!==f&&f,v=r.insertToInput,L=void 0!==v&&v,y=r.cache,g=void 0!==y&&y,A=r.disableCloseOnSelect,b=void 0!==A&&A,x=r.classGroup,C=r.classPreventClosing,S=r.onResults,E=void 0===S?function(){}:S,T=r.onSearch,I=void 0===T?function(){}:T,B=r.onSubmit,k=void 0===B?function(){}:B,O=r.onOpened,w=void 0===O?function(){}:O,D=r.onReset,R=void 0===D?function(){}:D,F=r.onRender,j=void 0===F?function(){}:F,W=r.onClose,G=void 0===W?function(){}:W,H=r.noResults,U=void 0===H?function(){}:H,N=r.onSelectedItem,P=void 0===N?function(){}:N;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t(this,"init",(function(){a.clearbutton(),a.output(),a.root.addEventListener("input",a.handleInput),a.onRender({element:a.root,results:a.resultList})})),t(this,"cacheAct",(function(e,t){if(a.cache){var n=document.getElementById(a.search);"update"===e&&n.setAttribute(a.cacheData,t.value),"remove"===e&&n.removeAttribute(a.cacheData),"root"===e&&(a.root.value=n.getAttribute(a.cacheData))}})),t(this,"handleInput",(function(e){var t=e.target,n=t.value.replace(a.regex,"\\$&");clearTimeout(a.timeout),a.timeout=setTimeout((function(){a.searchItem(n.trim())}),a.delay),a.cacheAct("update",t)})),t(this,"output",(function(){a.setAttr(a.resultList,{id:a.outputUl,tabIndex:0,role:"listbox"}),a.setAttr(a.resultWrapper,{id:"".concat(a.outputUl,"-wrapper"),addClass:"auto-output-search"}),a.resultWrapper.insertAdjacentElement("beforeend",a.resultList),a.root.parentNode.insertBefore(a.resultWrapper,a.root.nextSibling)})),t(this,"reset",(function(){var e;a.setAttr(a.root,{"aria-owns":"".concat(a.search,"-list"),"aria-expanded":!1,"aria-autocomplete":"list","aria-activedescendant":"",role:"combobox",removeClass:"auto-expanded"}),a.resultWrapper.classList.remove(a.isActive),a.resultList.scrollTop=0,0!=(null===(e=a.matches)||void 0===e?void 0:e.length)||a.toInput||(a.resultList.innerHTML=""),a.index=a.selectFirst?0:-1,a.onClose()})),t(this,"searchItem",(function(t){a.value=t,a.onLoading(!0),a.showBtn(),0==t.length&&a.clearButton&&a.clearBtn.classList.add("hidden"),a.characters>t.length?a.onLoading():a.onSearch({currentValue:t,element:a.root}).then((function(s){a.matches=Array.isArray(s)?n(s):JSON.parse(JSON.stringify(s)),a.onLoading(),a.error(),0==s.length&&0==a.root.value.length&&a.clearBtn.classList.add("hidden"),0==s.length&&a.root.value.length?(a.root.classList.remove("auto-expanded"),a.reset(),a.noResults({element:a.root,currentValue:t,template:a.results}),a.events()):(s.length>0||function(t){return t&&"object"===e(t)&&t.constructor===Object}(s))&&(a.index=a.selectFirst?0:-1,a.results(),a.events())})).catch((function(){a.onLoading(),a.reset()}))})),t(this,"onLoading",(function(e){return a.root.parentNode.classList[e?"add":"remove"](a.isLoading)})),t(this,"error",(function(){return a.root.classList.remove(a.err)})),t(this,"events",(function(){var e=[].slice.call(a.resultList.children);a.root.addEventListener("keydown",a.handleKeys),a.root.addEventListener("click",a.handleShowItems);for(var t=0;t<e.length;t++)e[t].addEventListener("mousemove",a.handleMouse),e[t].addEventListener("click",a.handleMouse,!1);document.addEventListener("click",a.handleDocClick)})),t(this,"results",(function(e){a.setAttr(a.root,{"aria-expanded":!0,addClass:"auto-expanded"}),a.resultList.innerHTML=0===a.matches.length?a.onResults({currentValue:a.value,matches:0,template:e}):a.onResults({currentValue:a.value,matches:a.matches,classGroup:a.classGroup}),a.resultWrapper.classList.add(a.isActive);var t=a.classGroup?":not(.".concat(a.classGroup,")"):"";a.itemsLi=document.querySelectorAll("#".concat(a.outputUl," > li").concat(t)),a.selectFirstEl(),a.onOpened({type:"results",element:a.root,results:a.resultList}),a.addAria()})),t(this,"handleDocClick",(function(e){var t=e.target,n=null;t.closest("ul")&&a.disableCloseOnSelect&&(n=!0),t.closest(".".concat(a.classPreventClosing))&&(n=!0),t.id===a.search||n||a.reset()})),t(this,"addAria",(function(){for(var e=0;e<a.itemsLi.length;e++)a.setAttr(a.itemsLi[e],{role:"option",tabindex:-1,"aria-selected":"false","aria-setsize":a.itemsLi.length,"aria-posinset":e})})),t(this,"selectFirstEl",(function(){if(a.remAria(document.querySelector(".".concat(a.activeList))),a.selectFirst){var e=a.resultList.firstElementChild,t=a.classGroup&&a.matches.length>0&&a.selectFirst?e.nextElementSibling:e;a.setAttr(t,{id:"".concat(a.selectedOption,"-0"),addClass:a.activeList,"aria-selected":!0}),a.setAriaDes("".concat(a.selectedOption,"-0")),a.follow(e,a.resultList)}})),t(this,"showBtn",(function(){a.clearBtn&&(a.clearBtn.classList.remove("hidden"),a.clearBtn.addEventListener("click",a.destroy))})),t(this,"setAttr",(function(e,t){for(var n in t)"addClass"===n?e.classList.add(t[n]):"removeClass"===n?e.classList.remove(t[n]):e.setAttribute(n,t[n])})),t(this,"handleShowItems",(function(){a.resultList.textContent.length>0&&!a.resultWrapper.classList.contains(a.isActive)&&(a.setAttr(a.root,{"aria-expanded":!0,addClass:"auto-expanded"}),a.resultWrapper.classList.add(a.isActive),a.selectFirstEl(),a.onOpened({type:"showItems",element:a.root,results:a.resultList}))})),t(this,"handleMouse",(function(e){e.preventDefault();var t=e.target,n=e.type,s=t.closest("li"),o=null==s?void 0:s.hasAttribute("role");s&&o&&("click"===n&&a.getTextFromLi(s),s.classList.contains(a.activeList)||"mousemove"===n&&(a.remAria(document.querySelector(".".concat(a.activeList))),a.setAria(s),a.index=a.indexLiSelected(s),a.onSelectedItem({index:a.index,element:a.root,object:a.matches[a.index]})))})),t(this,"getTextFromLi",(function(e){e&&0!==a.matches.length?(a.addToInput(e),a.onSubmit({index:a.index,element:a.root,object:a.matches[a.index],results:a.resultList}),a.disableCloseOnSelect||(a.remAria(e),a.reset()),a.clearButton&&a.clearBtn.classList.remove("hidden"),a.cacheAct("remove")):a.disableCloseOnSelect||a.reset()})),t(this,"firstElement",(function(e){return e.firstElementChild||e})),t(this,"addToInput",(function(e){a.root.value=a.firstElement(e).textContent.trim()})),t(this,"indexLiSelected",(function(e){return Array.prototype.indexOf.call(a.itemsLi,e)})),t(this,"handleKeys",(function(e){var t=e.keyCode,n=a.resultWrapper.classList.contains(a.isActive),s=a.matches.length+1;switch(a.selectedLi=document.querySelector(".".concat(a.activeList)),t){case a.keyCodes.UP:case a.keyCodes.DOWN:if(e.preventDefault(),s<=1&&a.selectFirst||!n)return;t===a.keyCodes.UP?(a.index<0&&(a.index=s-1),a.index-=1):(a.index+=1,a.index>=s&&(a.index=0)),a.remAria(a.selectedLi),s>0&&a.index>=0&&a.index<s-1?(a.onSelectedItem({index:a.index,element:a.root,object:a.matches[a.index]}),a.setAria(a.itemsLi[a.index]),a.toInput&&n&&a.addToInput(a.itemsLi[a.index])):(a.cacheAct("root"),a.setAriaDes());break;case a.keyCodes.ENTER:a.getTextFromLi(a.selectedLi);break;case a.keyCodes.TAB:case a.keyCodes.ESC:a.reset()}})),t(this,"setAria",(function(e){var t="".concat(a.selectedOption,"-").concat(a.indexLiSelected(e));a.setAttr(e,{id:t,"aria-selected":!0,addClass:a.activeList}),a.setAriaDes(t),a.follow(e,a.resultList)})),t(this,"getClassGroupHeight",(function(){var e=0;return[].slice.call(document.querySelectorAll("#".concat(a.outputUl," > li:not(.").concat(a.classGroup,")"))).map((function(t){return e+=t.offsetHeight})),e})),t(this,"follow",(function(e,t){var n=t.previousSibling,s=n?n.offsetHeight:0;if("0"==e.getAttribute("aria-posinset")&&(t.scrollTop=e.offsetTop-a.getClassGroupHeight()),e.offsetTop-s<t.scrollTop)console.log("test"),t.scrollTop=e.offsetTop-s;else{var o=e.offsetTop+e.offsetHeight-s;o>t.scrollTop+t.offsetHeight&&(t.scrollTop=o-t.offsetHeight)}})),t(this,"remAria",(function(e){e&&a.setAttr(e,{id:"",removeClass:a.activeList,"aria-selected":!1})})),t(this,"setAriaDes",(function(e){return a.root.setAttribute("aria-activedescendant",e||"")})),t(this,"clearbutton",(function(){a.clearButton&&(a.clearBtn=document.createElement("button"),a.setAttr(a.clearBtn,{id:"auto-clear-".concat(a.search),class:"auto-clear hidden",type:"button","aria-label":"claar text from input"}),a.root.insertAdjacentElement("afterend",a.clearBtn))})),t(this,"destroy",(function(){a.clearButton&&a.clearBtn.classList.add("hidden"),a.root.value="",a.root.focus(),a.resultList.textContent="",a.reset(),a.error(),a.onReset(a.root),a.root.removeEventListener("keydown",a.handleKeys),a.root.removeEventListener("click",a.handleShowItems),document.removeEventListener("click",a.handleDocClick)})),this.search=o,this.root=document.getElementById(this.search),this.onSearch=(i=I,Boolean(i&&"function"==typeof i.then)?I:function(e){var t=e.currentValue,n=e.element;return Promise.resolve(I({currentValue:t,element:n}))}),this.onResults=E,this.onRender=j,this.onSubmit=k,this.onSelectedItem=P,this.onOpened=w,this.onReset=R,this.noResults=U,this.onClose=G,this.delay=l,this.characters=m,this.clearButton=d,this.selectFirst=p,this.toInput=L,this.classGroup=x,this.classPreventClosing=C,this.disableCloseOnSelect=b,this.cache=g,this.outputUl="auto-".concat(this.search),this.cacheData="data-cache-auto-".concat(this.search),this.isLoading="auto-is-loading",this.isActive="auto-is-active",this.activeList="auto-selected",this.selectedOption="auto-selected-option",this.err="auto-error",this.regex=/[|\\{}()[\]^$+*?.]/g,this.timeout=null,this.resultWrapper=document.createElement("div"),this.resultList=document.createElement("ul"),this.keyCodes={ESC:27,ENTER:13,UP:38,DOWN:40,TAB:9},this.init()}}();
