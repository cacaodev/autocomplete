var Autosuggest=function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}return function i(s,r){var a,o=this,c=r.delay,l=r.clearButton,u=r.howManyCharacters,d=r.onResults,h=r.selectFirst,f=r.onSearch,m=r.onSubmit,p=void 0===m?function(){}:m;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),t(this,"initialize",(function(){o.selectedIndex=o.selectFirst?0:-1,o.createClearButton(),o.outputSearch(),o.setDefault(),o.input.addEventListener("input",o.handleInput)})),t(this,"handleInput",(function(e){var t=e.target,n=null;t.value.replace(o.regex,""),clearTimeout(n),n=setTimeout((function(){o.searchItem(t.value.trim())}),o.delay)})),t(this,"outputSearch",(function(){o.resultList=document.createElement("ul"),o.setAttribute(o.resultList,{id:o.searchOutputUl,addClass:"auto-output-search",tabIndex:0,role:"listbox"}),o.input.parentNode.insertBefore(o.resultList,o.input.nextSibling)})),t(this,"setDefault",(function(){o.setAttribute(o.input,{"aria-owns":"".concat(o.search,"-list"),"aria-expanded":!1,"aria-autocomplete":"both","aria-activedescendant":"",role:"combobox",removeClass:"expanded"}),o.resultList.classList.remove(o.isActive),o.resultList.scrollTop=0,o.selectedIndex=o.selectFirst?0:-1})),t(this,"searchItem",(function(t){o.value=t,o.onLoading(!0),o.showHiddenButton(),o.howManyCharacters>t.length?o.onLoading():o.onSearch(t).then((function(t){var i;o.matches=Array.isArray(t)?n(t):JSON.parse(JSON.stringify(t)),o.onLoading(),o.onError(),0==t.length?(o.input.classList.remove("expanded"),o.setDefault()):(t.length>0||(i=t)&&"object"===e(i)&&i.constructor===Object)&&(o.renderResults(),o.handleEvents())})).catch((function(){o.onLoading(),o.setDefault()}))})),t(this,"onLoading",(function(e){o.input.parentNode.classList[e?"add":"remove"](o.isLoading)})),t(this,"onError",(function(e){o.input.classList[e?"add":"remove"](o.error)})),t(this,"handleEvents",(function(){o.input.addEventListener("keydown",o.handleKeys),o.input.addEventListener("click",o.handleShowItems),o.resultList.addEventListener("click",o.handleMouse),o.resultList.addEventListener("mousemove",o.handleMouse),document.addEventListener("click",o.handleDocumentClick)})),t(this,"renderResults",(function(){o.setAttribute(o.input,{"aria-expanded":!0,addClass:"expanded"}),o.resultList.innerHTML=o.onResults(o.matches,o.value),o.resultList.classList.add(o.isActive),o.itemsLi=document.querySelectorAll("#".concat(o.searchOutputUl," > li")),o.selectFirstEl(),o.addAriaLabelToLi()})),t(this,"handleDocumentClick",(function(e){e.target.id===o.search||o.setDefault()})),t(this,"addAriaLabelToLi",(function(){for(var e=0;e<o.itemsLi.length;e++)o.setAttribute(o.itemsLi[e],{role:"option",tabindex:-1,"aria-selected":"false"})})),t(this,"selectFirstEl",(function(){if(o.removeAriaSelected(document.querySelector(".".concat(o.activeList))),o.selectFirst){var e=o.resultList.firstElementChild;o.setAttribute(e,{id:"".concat(o.selectedOption,"-0"),addClass:o.activeList,"aria-selected":!0}),o.setAriaDescendant(o.input,"".concat(o.selectedOption,"-0")),o.followElement(e,o.resultList)}})),t(this,"showHiddenButton",(function(){o.clearButton&&(o.clearButton.classList.remove("hidden"),o.clearButton.addEventListener("click",o.handleClearButton))})),t(this,"setAttribute",(function(e,t){for(var n in t)"addClass"===n?e.classList.add(t[n]):"removeClass"===n?e.classList.remove(t[n]):e.setAttribute(n,t[n])})),t(this,"handleShowItems",(function(){o.resultList.textContent.length>0&&(o.setAttribute(o.input,{"aria-expanded":!0,addClass:"expanded"}),o.resultList.classList.add(o.isActive),o.selectFirstEl())})),t(this,"handleMouse",(function(e){var t=e.screenX,n=e.screenY,i=e.target,s=e.type,r=i.closest("li");if(r){var a={x:0,y:0};if("click"===s&&o.getTextFromLi(r),"mousemove"===s){var c={x:t,y:n};if(c.x===a.x&&c.y===a.y)return;a={x:t,y:n},o.removeAriaSelected(document.querySelector(".".concat(o.activeList))),o.setAriaSelectedItem(r),o.selectedIndex=o.indexLiSelected(r)}}})),t(this,"getTextFromLi",(function(e){e&&(o.getText=e.firstElementChild?e.firstElementChild:e,o.input.value=o.getText.textContent.trim(),o.removeAriaSelected(e),o.onSubmit(o.matches[o.selectedIndex],o.input.value),o.setDefault())})),t(this,"indexLiSelected",(function(e){return Array.prototype.indexOf.call(o.itemsLi,e)})),t(this,"handleKeys",(function(e){var t=e.keyCode;switch(o.selectedLi=document.querySelector(".".concat(o.activeList)),t){case o.keyCodes.UP:case o.keyCodes.DOWN:if(o.matches.length<=1&&o.selectFirst)return;t===o.keyCodes.UP?(o.selectedIndex-=1,o.selectedIndex<0&&(o.selectedIndex=o.matches.length-1)):(o.selectedIndex+=1,o.selectedIndex>=o.matches.length&&(o.selectedIndex=0)),o.removeAriaSelected(o.selectedLi),o.setAriaSelectedItem(o.itemsLi[o.selectedIndex]);break;case o.keyCodes.ENTER:o.removeAriaSelected(o.selectedLi),o.getTextFromLi(o.selectedLi);break;case o.keyCodes.TAB:case o.keyCodes.ESC:o.setDefault()}})),t(this,"setAriaSelectedItem",(function(e){o.setAttribute(e,{id:"".concat(o.selectedOption,"-").concat(o.indexLiSelected(e)),"aria-selected":!0,addClass:o.activeList}),o.setAriaDescendant(o.input,"".concat(o.selectedOption,"-").concat(o.indexLiSelected(e))),o.followElement(e,o.resultList)})),t(this,"followElement",(function(e,t){if(e.offsetTop<t.scrollTop)t.scrollTop=e.offsetTop;else{var n=e.offsetTop+e.offsetHeight;n>t.scrollTop+t.offsetHeight&&(t.scrollTop=n-t.offsetHeight)}})),t(this,"removeAriaSelected",(function(e){e&&o.setAttribute(e,{id:"",removeClass:o.activeList,"aria-selected":!1})})),t(this,"setAriaDescendant",(function(e,t){e.setAttribute("aria-activedescendant",t||"")})),t(this,"createClearButton",(function(){o.clearButton&&(o.clearButton=document.createElement("button"),o.setAttribute(o.clearButton,{id:"auto-clear-".concat(o.search),class:"auto-clear hidden",type:"button","aria-label":"claar text from input"}),o.input.insertAdjacentElement("afterend",o.clearButton))})),t(this,"handleClearButton",(function(e){e.target.classList.add("hidden"),o.input.value="",o.input.focus(),o.resultList.textContent="",o.setDefault(),o.onError()})),this.search=s,this.input=document.getElementById(this.search),this.onResults=d,this.onSubmit=p,this.onSearch=(a=f,Boolean(a&&"function"==typeof a.then)?f:function(e){return Promise.resolve(f(e))}),this.delay=c||500,this.howManyCharacters=u||2,this.clearButton=l||!1,this.selectFirst=h||!1,this.searchOutputUl="".concat(this.search,"-list"),this.isLoading="auto-is-loading",this.isActive="auto-is-active",this.activeList="auto-selected",this.selectedOption="selectedOption",this.error="auto-error",this.regex=/[`~!@#$%^&*()_|+\-=÷¿?;:'",.<>{}[\]\\/]/g,this.keyCodes={ESC:27,ENTER:13,UP:38,DOWN:40,TAB:9},this.initialize()}}();
